# Causal Inference Panel Data — Simulation & Method Benchmarking Pipeline

A fully automated, high-performance workflow for benchmarking causal inference estimators in longitudinal panel data with time-varying confounding.  
The pipeline operationalizes the ADEMP framework end-to-end, with **A — Aim** of benchmarking methodologies for cross-lagged effect estimation:

- **D — Data-Generating Mechanism**  
- **E — Estimands**  
- **M — Methods (SEM + Bayesian DYNAMITE + G-formula)**  
- **P — Performance Evaluation**

The system is engineered for reproducibility on HPC environments and scales to thousands of Monte Carlo replications per scenario.

---

## 1. Project Overview

This repository implements a controlled laboratory for comparing causal estimators in dynamic panel settings.  
The data-generating mechanism creates synthetic longitudinal data with:

- A time-varying latent confounder  
- Cross-lagged feedback between exposure (X) and outcome (Y)  
- Three causal scenarios:
  1. **No causal effect**
  2. **Unidirectional effect (X → Y)**
  3. **Bidirectional feedback (X ↔ Y)**

Downstream components compute true causal estimands, run competing estimation methods, and generate a full suite of performance diagnostics.

---

## 2. Directory Structure

```text
project_root/
│
├── D-data_generating_mechanism.R
├── E-estimands.R
├── M-SEM.R
├── M-dynamite-core.R
├── P-performance.R
│
├── data/                     # RDS datasets generated by DGM (per scenario × replicate)
├── meta/                     # RNG log, session info, figures
│   └── figures/              # Trajectories, scatter matrices, mean plots
│
├── estimands/                # Analytic + Monte Carlo “truth” estimands
│
├── methods/
│   ├── g-formula/            # G-formula fits
│   ├── sem/                  # SEM fits, summaries, performance metrics
│   └── dynamite/             # MCMC fits, posterior summaries, checkpoints, metrics
│
└── performance/
    ├── tables/               # Combined performance tables
    ├── plots/                # Benchmark visualizations
    └── combined/             # Unified dataset for analytics
```

---

## 3. Component Summary

### **D — Data Generating Mechanism (`D-data_generating_mechanism.R`)**

- Produces panel data under scenarios 1–3  
- Time-varying confounder evolves via gamma-distributed increments  
- Exposure/outcome follow AR processes with optional causal feedback  
- Saves:
  - Raw datasets (`/data`)
  - Trajectory plots, scatter matrices (`/meta/figures`)
  - RNG logs and session metadata

### **E — Estimands (`E-estimands.R`)**

- Computes **analytic causal effects (ACE\_{XY}, ACE\_{YX})** from structural coefficients  
- Validates via **large-N Monte Carlo**  
- Outputs:
  - `analytic_estimands.csv`
  - `montecarlo_estimands.csv`
  - `final_estimands_summary.csv`

### **M — Methods**

#### **SEM (`M-SEM.R`)**
- Cross-lagged SEM with time-varying confounder using **lavaan**  
- Saves full fit objects + coefficient tables  
- Computes bias, SEs, RMSE, coverage  

#### **DYNAMITE (`M-dynamite-core.R`)**
- Bayesian dynamic panel model using **dynamite**  
- Standardizes variables, rescales effects  
- Automated checkpointing for HPC jobs  
- Posterior extractions + performance metrics

### **P — Performance (`P-performance.R`)**

Cross-method diagnostics:

- Density plots  
- Boxplots  
- Replicate-level jitter plots  
- Bias / RMSE / Coverage barplots  
- ZIP plots  
- Lollipop charts  
- Limits-of-agreement (SEM vs DYNAMITE)  
- SE(model) diagnostics  

Outputs stored under `/performance`.

---

## 4. Requirements

- **R ≥ 4.1**
- **HPC or multicore environment highly recommended:** DYNAMITE fitting is computationally intensive. For a stable performance, allocate **≈72 GB RAM** and **≥4 CPU cores**.

### Key R packages
```r
# Core dependencies
library(tidyverse)
library(data.table)
library(patchwork)
library(lavaan)
library(dynamite)
library(purrr)
library(glue)
library(ggplot2)
```
---

## 5. References

- Morris, T. P., White, I. R., & Crowther, M. J. (2019).  
  *Using simulation studies to evaluate statistical methods.*  
  **Statistics in Medicine, 38(11), 2074–2102.**  
  https://doi.org/10.1002/sim.8086

- Fox, J., Nie, Z., Byrnes, J., Culbertson, M., DebRoy, S., Friendly, M., Goodrich, B., Jones, R. H., Kramer, A., Monette, G., Novomestky, F., & R Core Team. (2024).  
  *sem: Structural equation modeling* (R package version).  
  https://doi.org/10.32614/CRAN.package.sem

- Tikka, S., Helske, J., Clark, N., & McGowan, L. D. (2025).  
  *dynamite: Bayesian dynamic multivariate panel models* (R package version).  
  https://doi.org/10.32614/CRAN.package.dynamite

